{% extends 'dashboard/base.html' %} {% load static %} {% block content %}
<nav class="nxl-navigation">
  <div class="navbar-wrapper">
    <div class="m-header">
    </div>
    <div class="navbar-content">
      <ul class="nxl-navbar">
        <li class="nxl-item nxl-caption">
          <label>Navigation</label>
        </li>
        <li class="nxl-item nxl-hasmenu">
          <a href="javascript:void(0);" class="nxl-link">
            <span class="nxl-micon"><i class="feather-airplay"></i></span>
            <span class="nxl-mtext">Energy prediction</span
            ><span class="nxl-arrow"
              ><i class="feather-chevron-right"></i
            ></span>
          </a>
          <ul class="nxl-submenu">
            <li class="nxl-item">
              <a class="nxl-link" href="{% url 'dashboard' %}">Energy prediction</a>
            </li>
            <li class="nxl-item">
              <a class="nxl-link" href="{% url 'analytics' %}">Analytics</a>
            </li>
          </ul>
        </li>
        
        
      </ul>
    </div>
  </div>
</nav>
<!--! ================================================================ !-->
<!--! [End]  Navigation Manu !-->
<!--! ================================================================ !-->
<!--! ================================================================ !-->
<!--! [Start] Header !-->
<!--! ================================================================ !-->
<header class="nxl-header">
  <div class="header-wrapper">
    <!--! [Start] Header Left !-->
    <div class="header-left d-flex align-items-center gap-4">
      <!--! [Start] nxl-head-mobile-toggler !-->
      <a
        href="javascript:void(0);"
        class="nxl-head-mobile-toggler"
        id="mobile-collapse"
      >
        <div class="hamburger hamburger--arrowturn">
          <div class="hamburger-box">
            <div class="hamburger-inner"></div>
          </div>
        </div>
      </a>
      <!--! [Start] nxl-head-mobile-toggler !-->
      <!--! [Start] nxl-navigation-toggle !-->
      <div class="nxl-navigation-toggle">
        <a href="javascript:void(0);" id="menu-mini-button">
          <i class="feather-align-left"></i>
        </a>
        <a
          href="javascript:void(0);"
          id="menu-expend-button"
          style="display: none"
        >
          <i class="feather-arrow-right"></i>
        </a>
      </div>
      <!--! [End] nxl-navigation-toggle !-->
      <!--! [Start] nxl-lavel-mega-menu-toggle !-->
      <div class="nxl-lavel-mega-menu-toggle d-flex d-lg-none">
        <a href="javascript:void(0);" id="nxl-lavel-mega-menu-open">
          <i class="feather-align-left"></i>
        </a>
      </div>
      <!--! [End] nxl-lavel-mega-menu-toggle !-->
      <!--! [Start] nxl-lavel-mega-menu !-->
      <div class="nxl-drp-link nxl-lavel-mega-menu">
        <div class="nxl-lavel-mega-menu-toggle d-flex d-lg-none">
          <a href="javascript:void(0)" id="nxl-lavel-mega-menu-hide">
            <i class="feather-arrow-left me-2"></i>
            <span>Back</span>
          </a>
        </div>
        <!--! [Start] nxl-lavel-mega-menu-wrapper !-->
        <!--! [End] nxl-lavel-mega-menu-wrapper !-->
      </div>
      <!--! [End] nxl-lavel-mega-menu !-->
    </div>
    <!--! [End] Header Left !-->
    <!--! [Start] Header Right !-->
    <div class="header-right ms-auto">
      <div class="d-flex align-items-center">
        
        
        <div class="dropdown nxl-h-item">
          <a
            class="nxl-head-link me-3"
            data-bs-toggle="dropdown"
            href="#"
            role="button"
            data-bs-auto-close="outside"
          >
            <i class="feather-bell"></i>
            <span class="badge bg-danger nxl-h-badge">0</span>
          </a>
          <div
            class="dropdown-menu dropdown-menu-end nxl-h-dropdown nxl-notifications-menu"
          >
            <div
              class="d-flex justify-content-between align-items-center notifications-head"
            >
              <h6 class="fw-bold text-dark mb-0">Notifications</h6>
              <a
                href="javascript:void(0);"
                class="fs-11 text-success text-end ms-auto"
                data-bs-toggle="tooltip"
                title="Make as Read"
              >
                <i class="feather-check"></i>
                <span>Make as Read</span>
              </a>
            </div>
            <div class="notifications-item">
              <img
                src="{% static 'images/avatar/2.png' %}"
                alt=""
                class="rounded me-3 border"
              />
              {% for notification in unread_notifications %}
          <div class="notifications-item">
              <img
                  src="{% static 'images/avatar/notification.png' %}"
                  alt=""
                  class="rounded me-3 border"
              />
              <div class="notifications-desc">
                  <a href="javascript:void(0);" class="font-body text-truncate-2-line">
                      <span class="fw-semibold text-dark">{{ notification.message }}</span>
                  </a>
                  <div class="d-flex justify-content-between align-items-center">
                      <div class="notifications-date text-muted border-bottom border-bottom-dashed">
                          {{ notification.created_at|date:"Y-m-d H:i" }}
                      </div>
                      <div class="d-flex align-items-center float-end gap-2">
                          <a
                              href="{% url 'mark_notification_as_read' notification.id %}"
                              class="d-block wd-8 ht-8 rounded-circle bg-gray-300"
                              data-bs-toggle="tooltip"
                              title="Mark as Read"
                          ></a>
                          <a
                              href="{% url 'delete_notification' notification.id %}"
                              class="text-danger"
                              data-bs-toggle="tooltip"
                              title="Remove"
                          >
                              <i class="feather-x fs-12"></i>
                          </a>
                      </div>
                  </div>
              </div>
          </div>
          {% empty %}
          <div class="notifications-item">
              <p class="text-muted">No new notifications.</p>
          </div>
          {% endfor %}
          </div>
        </div>
        <div class="dropdown nxl-h-item">
          <a
            href="javascript:void(0);"
            data-bs-toggle="dropdown"
            role="button"
            data-bs-auto-close="outside"
          >
            <img
              src="{% static 'images/avatar/1.png' %}"
              alt="user-image"
              class="img-fluid user-avtar me-0"
            />
          </a>
          <div
            class="dropdown-menu dropdown-menu-end nxl-h-dropdown nxl-user-dropdown"
          >
            <div class="dropdown-header">
              <div class="d-flex align-items-center">
                <img
                  src="{% static 'images/avatar/1.png' %}"
                  alt="user-image"
                  class="img-fluid user-avtar"
                />
                <div>
                  <h6 class="text-dark mb-0">{{ user.username }} <!-- Display the user's full name --></h6>
                  <span class="fs-12 fw-medium text-muted">{{ user.email }}</span> <!-- Display the user's email -->
                </div>
              </div>
            </div>
            
            <div class="dropdown-divider"></div>
            <a href="javascript:void(0);" class="dropdown-item">
              <i class="feather-user"></i>
              <span>Profile Details</span>
            </a>
            <form id="logout-form" action="{% url 'logout' %}" method="post" style="display: none;">
              {% csrf_token %}
            </form>
            <a href="javascript:void(0);" onclick="document.getElementById('logout-form').submit();" class="dropdown-item">
              <i class="feather-log-out"></i>
              <span>Logout</span>
          </a>
          </div>
        </div>
      </div>
    </div>
    <!--! [End] Header Right !-->
  </div>
</header>

<main class="nxl-container">
  <div class="nxl-content">
    <div class="page-header">
        <div class="page-header-left d-flex align-items-center">
            <div class="page-header-title">
                <h5 class="m-b-10">Analytics</h5> <!-- Changed title to Analytics -->
            </div>
        </div>
    </div>
    <div class="row pt-4 px-4">
      <div class="row pt-4 px-4">
        <div class="col-lg-8">
          <!-- Card for Solar Energy Prediction vs Actual -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">Solar Energy Prediction vs Actual</h5>
              <canvas id="energyChart"></canvas> <!-- Updated Chart ID -->
            </div>
          </div>
          <!-- Card for Prediction Accuracy Trend -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">Prediction Accuracy Trend</h5>
              <canvas id="accuracyChart"></canvas> <!-- New Chart for Accuracy -->
            </div>
          </div>
        </div>
        <!-- Summary of Discrepancies -->
        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">Discrepancies Summary</h5>
              <p>If discrepancies between predicted and actual energy generation exceed the threshold, the system will alert you.</p>
              <p>Current Discrepancy: {{ average_discrepancy }}%</p>
              <p>Status: <span class="{% if discrepancy_status == 'Normal' %}text-success{% else %}text-danger{% endif %}">
                  {{ discrepancy_status }}
              </span></p>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

{% endblock %}

{% block extra_js %}
<script type="text/javascript">
  // Solar Energy Prediction vs Actual Chart
  const solarCtx = document.getElementById('energyChart').getContext('2d');
  new Chart(solarCtx, {
      type: 'bar',
      data: {
          labels: {{ weather_labels|safe }},
          datasets: [{
              label: 'Actual Energy Generated (kWh)',
              data: {{ actual_solar_energy|safe }},
              backgroundColor: 'rgba(75, 192, 192, 0.6)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1,
          }, {
              label: 'Expected Energy Generation (kWh)',
              data: {{ expected_solar_energy|safe }},
              backgroundColor: 'rgba(255, 159, 64, 0.6)',
              borderColor: 'rgba(255, 159, 64, 1)',
              borderWidth: 1,
          }]
      },
      options: {
          responsive: true,
          scales: {
              y: {
                  beginAtZero: true,
                  title: {
                      display: true,
                      text: 'Energy (kWh)'
                  }
              },
              x: {
                  title: {
                      display: true,
                      text: 'Date'
                  }
              }
          }
      }
  });

  // Prediction Accuracy Trend Chart
  const accuracyCtx = document.getElementById('accuracyChart').getContext('2d');
  new Chart(accuracyCtx, {
      type: 'line',
      data: {
          labels: {{ weather_labels|safe }},
          datasets: [{
              label: 'Prediction Accuracy (%)',
              data: {{ prediction_accuracy|safe }},
              borderColor: 'rgba(54, 162, 235, 1)',
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              fill: true,
              tension: 0.1
          }]
      },
      options: {
          responsive: true,
          scales: {
              y: {
                  beginAtZero: true,
                  title: {
                      display: true,
                      text: 'Accuracy (%)'
                  },
                  max: 100
              },
              x: {
                  title: {
                      display: true,
                      text: 'Date'
                  }
              }
          }
      }
  });
</script>


{% endblock %}